<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>note</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR&family=Roboto:wght@400;500&display=swap" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  </head>

  <style>
    /* ìƒë‹¨ ê³ ì • */
    * {
      font-family: "Noto Serif KR", serif;
      color: #78715e;
    }

    body {
      background-color: #ece8e4;
      position: relative;
    }

    header {
      background-color: #e1ddd6;
      position: fixed;
      z-index: 100;
      height: 40px;
      width: 100%;
    }

    nav {
      background-color: #e1ddd6;
    }

    main {
      min-height: 2000px;
    }

    footer {
      font-size: smaller;
      height: 140px;
      /* background-color: #78715e; */
      text-align: center;
      /* color: whitesmoke; */
    }

    .navbar {
      margin-top: -1%;
      width: 100%;
    }

    /* ë³€ë™ */
    .thumbnailBox {
      position: relative;
      top: 80px;
      height: 300px;
      /* border: 1px solid #78715e; */
    }

    .postTitleBox {
      position: relative;
      top: 80px;
      height: 60px;
      /* border: 1px solid #78715e; */
    }

    .ContentBox {
      position: relative;
      top: 80px;
      /* height: 1000px;
      border: 1px solid #78715e; */
    }

    .noneBox {
      position: relative;
      top: 80px;
      height: 50px;
      /* border: 1px solid #78715e; */
    }

    .commentBox {
      position: relative;
      top: 80px;
      height: 500px;
      border: 1px solid #78715e;
    }

    .comment {
      font-weight: bolder;
      font-size: larger;
    }

    .addComment {
      border: 1px solid #78715e;
      color: #78715e;
    }

    .addComment:hover {
      border: 1px solid #78715e;
      background-color: #78715e;
      color: whitesmoke;
    }

    .editOkComment {
      border: 1px solid #78715e;
      background-color: #78715e;
      color: whitesmoke;


      .editOkComment:hover {
        border: 1px solid #78715e;
        color: #78715e;
      }
    }

    .polaroid {
      background: #000;
      /*Change this to a background image or remove*/
      border: solid #fff;
      border-width: 6px 6px 20px 6px;
      box-shadow: 1px 1px 5px #333;
      /* Standard blur at 5px. Increase for more depth */
      -webkit-box-shadow: 1px 1px 5px #333;
      -moz-box-shadow: 1px 1px 5px #333;
      height: 250px;
      /*Set to height of your image or desired div*/
      width: 250px;
      /*Set to width of your image or desired div*/
    }

    .commentTextColor {
      color: #78715e;

    }
  </style>
  <body>
    <!-- ------------header------------ -->
    <header><%- include ('fragment/header') %></header>

    <!-- ------------main------------ -->
    <main>
      <%
      function removeHtmlTags(input) {
        return input.replace(/<[^>]*>/g, '');
      }
      %>
      <!-- ì¸ë„¤ì¼ ì˜ì—­ -->
      <div class="container thumbnailBox mx-auto m-1" id="thumbnailBox">
        <img src="http://<%=note.img%>" class="img-responsive center-block d-block mx-auto polaroid" />


        <!-- ------------ê²Œì‹œê¸€ ìˆ˜ì • ì‚­ì œ ë²„íŠ¼------------ -->
        <div align="right" id="noteEditButton">
        
        <span style="display:none" id="user"> <%=note.connectUser %></span>
        <div id="forUser">

          <a href="/notebook/notemodify/<%=note.noteId%>">
            <button type="button" class="btn addComment justify-content-end">ìˆ˜ì •</button>
          </a>
          <a href="/notebook/notedelete/<%=note.noteId%>">
            <button type="button" onclick="myNoteDelete()" class="btn addComment justify-content-end">ì‚­ì œ</button>
          </a>
        </div>
        
        </div>
      </div>

      <!-- ------------  note ë°ì´í„°ë¡œ ë“¤ì–´ì˜µë‹ˆë‹¤.  ------------ -->
      <!-- ------------ì œëª© ì˜ì—­------------ -->
      <div class="container postTitleBox mx-auto m-1">
        <h1 class="display-6"><%= removeHtmlTags(note.title) %>
        </h1>
        <hr />
        <!-- ------------ê²Œì‹œê¸€ ì˜ì—­------------ -->
        <div class="container ContentBox mx-auto m-1">
          <%= removeHtmlTags(note.content) %>

        </div>
        <!-- ------------ê²Œì‹œê¸€ ë°‘ ê³µë°± ë¹ˆ ë°•ìŠ¤------------ -->
        <div class="container noneBox mx-auto m-1">

        </div>
        <!-- ------------ëŒ“ê¸€ ì˜ì—­------------ -->
        <div class="container commentBox mx-auto m-1">
          <div class="mb-3">
            <label for="exampleFormControlTextarea1" class="form-label comment ">Comment</label>
            <!-- table-->
            <table class="table table-hover table-borderless">
              
            </table>
            <form name="inputComment">
              <textarea class="form-control" id="commentTextarea" rows="3" name="comment" placeholder="ëŒ“ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”."></textarea>
              <input type="hidden" name="noteId" value="<%= note.noteId %>" disabled/>
              <div align="right" class="commentBtnGroup">
                <div id="noComment"></div>
                <button type="button" onclick="addComment()" class="btn addComment justify-content-end" id="commentTextareaBtn">ì‘ì„±</button>
              </div>
          </form>
        </div>
    </main>
    <!-- ------------footer------------ -->

    <footer><%- include ('fragment/footer') %></footer>
    <!-- <span style="color: whitesmoke">
        <br />
        &nbsp; non-blogging <br />
        &nbsp; ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ : 000-00-00000<br />
        &nbsp; ì£¼ì†Œ : ì„œìš¸íŠ¹ë³„ì‹œ ìš©ì‚°êµ¬ í•œê°•ë¡œ <br />
        &nbsp; ëŒ€í‘œë²ˆí˜¸: 1644-0000<br />
        &nbsp; Copyright(c) 2023 non-blogging. All Rights Reserved.
      </span> -->

    <!-- ------------script------------ -->
    <script>
     const user = document.getElementById('user').innerText
     const userstorage =JSON.parse( localStorage.getItem('user'))
     console.log(user, userstorage)
      if(user!=userstorage){
        document.getElementById('forUser').style.display = 'none';
      }
      //--------------------ì¸ë„¤ì¼ ë„£ê³  ë¹¼ê¸° 
      const thumbnailBox = document.getElementById("thumbnailBox")


      //ì´ë¯¸ì§€ ì•ˆë°›ì•„ì™”ë‹¤ë©´? (ì„ì‹œ) ^^
      // let imageId = "";

      // if (!imageId) {
      //   thumbnailBox.style.display = "none";
      // } else if (imageId) {
      //   thumbnailBox.style.display = "block";
      // }

      function cancelUpdateComment(){
        location.reload();
      }

      //--------------------ëŒ“ê¸€ ë“±ë¡
      function addComment(){
        let commentText = document.getElementById("commentTextarea").value;
        let textElement = document.getElementById("noComment");
        if (commentText.trim() === "") {
          textElement.textContent = "ì‘ì„±ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.ğŸ˜…";
          return false;
        } else {
          textElement.textContent = "";
        }
        const form = document.forms["inputComment"];

        const data = {
          commentWrite: form.comment.value,
          noteId: form.noteId.value,
          email: form.email.value,
        };

        axios({
          method: "post",
          url: `/notebook/${'<%= note.noteId %>'}/comment`,
          data: data
        }).then((res)=>{
          // alert("ëŒ“ê¸€ ë‹¬ê¸° ì„±ê³µ!");
          location.reload();
        })
      }

      //--------------------ëŒ“ê¸€ ì‚­ì œ (ë³¸ì¸ ëŒ“ê¸€ë§Œ ì‚­ì œí•  ìˆ˜ ìˆì–´ì•¼ í•˜ë‹ˆ user id ê°’ì— ë”°ë¼ ì‚­ì œ ë²„íŠ¼ ì•ˆë³´ì´ë„ë¡.)
      //ì–˜ëŠ” ë…¸íŠ¸ì•„ì´ë””ë‘ì€ ë³„ê°œ. ëŒ“ê¸€ ìì²´ì˜ ì•„ì´ë””.
      //userê°€ í•´ë‹¹ ëŒ“ê¸€ì˜ idê°’ì„ ê°€ì§€ê³  ìˆëŠ”ì§€ì— ë”°ë¼ íŒë‹¨? 
      //ê° ëŒ“ê¸€ì˜ idê°’ì„ loginí•œ userê°€ ê°€ì§€ê³  ìˆëŠë‹¤ë©´ ì‚­ì œ ë²„íŠ¼ì´ ë³´ì—¬ì•¼í•œë‹¤; 
      //ë¡œê·¸ì¸í•œ ìœ ì €(ë¡œê·¸ì¸í•œ ê°’ì´ nullì´ ì•„ë‹ˆë©´ì„œ)ì´ë©´ì„œ + ëŒ“ê¸€ì‘ì„±ìì˜ idrê°€ ê°™ì•„ì•¼ í•œë‹¤.
      //ê·¸ëŸ¼ ëŒ“ê¸€ ì‘ì„±í•˜ë©´ì„œ ë¡œê·¸ì¸í•œ userIdê°’ì„ ë³´ë‚´ì•¼í•œë‹¤?
      //ëŒ“ê¸€ ì‘ì„±í•˜ë©´ì„œ ë¡œê·¸ì¸í•œ ë³¸ì´ idë¥¼ ê°™ì´ ë³´ë‚´ì•¼í•˜ë„¤
      function deleteComment(commentId) {
        let userConfirmed = window.confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ??");
        if(userConfirmed){
          axios({
            method: 'delete',
            url: `/notebook/${'<%= note.noteId %>'}/comment/${commentId}`
          }).then((res) => {
            alert("ëŒ“ê¸€ì„ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.");
            location.reload();
          }).catch((err) => {
            alert("ëŒ“ê¸€ì„ ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          })
        }
      }

      //--------------------ëŒ“ê¸€ ìˆ˜ì • (ë³¸ì¸ ëŒ“ê¸€ë§Œ ìˆ˜ì •í•  ìˆ˜ ìˆì–´ì•¼ í•˜ë‹ˆ user id ê°’ì— ë”°ë¼ ì‚­ì œ ë²„íŠ¼ ì•ˆë³´ì´ë„ë¡.
      //--------------------ëŒ“ê¸€ ìˆ˜ì • ì‚­ì œ ë²„íŠ¼ visibility
      //userê°€ ì‘ì„±í•œ ëŒ“ê¸€ì— ìˆëŠ” commentId ìœ ë¬´ì— ë”°ë¼.
      //*userê°€ í•´ë‹¹ commentIdë¥¼ ê°€ì§€ê³  ìˆëŠëƒ ì—†ëŠëƒ.
      //commentIdëŠ” ëŒ“ê¸€ì•„ì´ë””, userIdëŠ” ë¡œê·¸ì¸í•œìœ ì €ì•„ì´ë””

      // let commentId = "writer1"
      // let userId = "writer1"

      function updateComment(commentId) {
        axios({
          method: 'get',
          url: `/notebook/${'<%= note.noteId %>'}/comment/${commentId}`,
        }).then((res) => {
          const { commentWrite, nickname } = res.data;
          const form = document.forms['inputComment'];
          form.comment.value = commentWrite;
        });

        var btnGroup = document.querySelector(".commentBtnGroup");
          btnGroup.innerHTML = `
            <button type="button" onclick="updateCommentConfirm('${commentId}')" class="btn addComment justify-content-end" id="commentTextareaBtn">ìˆ˜ì •í•˜ê¸°</button>
            <button type="button" onclick="cancelUpdateComment()" class="btn addComment justify-content-end">ìˆ˜ì • ì·¨ì†Œ</button>
        `;
      }

      function updateCommentConfirm(commentId) {
        const form = document.forms["inputComment"];

        const data = {
          commentWrite: form.comment.value,
        };

        axios({
          method: "patch",
          url: `/notebook/${'<%= note.noteId %>'}/comment/${commentId}`,
          data: data
        }).then((res) => {
          console.log(res.data.result);
          // alert("ëŒ“ê¸€ ìˆ˜ì • ì„±ê³µ!");
          location.reload();
        }).catch((err) => {
          console.log(err);
          alert("ëŒ“ê¸€ ìˆ˜ì • ì‹¤íŒ¨");
        })
      }

      //--------------------ê²Œì‹œê¸€ ìˆ˜ì • ì‚­ì œ ë²„íŠ¼ visibility
      //userê°€ ì‘ì„±í•œ ë…¸íŠ¸ì— ìˆëŠ” noteId ìœ ë¬´ì— ë”°ë¼.
      //*userê°€ í•´ë‹¹ noteIdë¥¼ ê°€ì§€ê³  ìˆëŠëƒ ì—†ëŠëƒ.
      //noteIdëŠ” ê²Œì‹œê¸€ì•„ì´ë””, useIdëŠ” ë¡œê·¸ì¸í•œìœ ì €ì•„ì´ë””
      // let useId = "hi"
      // let noteId = "hi"

      function noteEditBtnShow(noteId, useId) {
        const showEditBrn = document.getElementById("noteEditButton")
        console.log("showEditBrn", showEditBrn)

        if (useId) {
          if (noteId === useId) {
            showEditBrn.style.visibility = "visible";
          } else {
            showEditBrn.style.visibility = "hidden";
          }
        }
      }
      noteEditBtnShow("hi", "hi")

      //-------------------------------------ê²Œì‹œê¸€ ìˆ˜ì • ë²„íŠ¼
      //ìœ ì €ê°€ ì‘ì„±í•œ ë°ì´í„° ê°’ ì–´ë–»ê²Œ ê°€ì ¸ì˜¤ì§€? ^^
      //í˜ì´ì§€ì— ì €ì¥ëœ ë‚´ìš© ê·¸ëŒ€ë¡œ ê°€ì ¸ì™€ì•¼í•œë‹¤.
      function myNoteEdit() {
        location.href = "/notebook/note";
      }

      //-------------------------------------ê²Œì‹œê¸€ ì‚­ì œ ë²„íŠ¼
      function myNoteDelete() {
        if (window.confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ??")) {
          location.href = "/notebook";
        } else {
          return false;
        }
      }
    </script>
  </body>
</html>